# Implementing Behler-Parinello symmetry functions

There are other codes that implement the [Behler-Parinello symmetry functions](https://pubs.aip.org/aip/jcp/article/134/7/074106/954787/Atom-centered-symmetry-functions-for-constructing) and
to my knowledge no one has used these functions as a CV for a metadynamics simulation.  It is, therefore, not unreasonable to ask if an implementation of these CVs in PLUMED is really necessary.
The implementation I will describe below was done relatively quickly and I hope it demonstrates how new functionality can be quickly prototyped in the modified version of PLUMED that I have described
in these pages.

## Implementing $G^1$ symmetry functions

The $G^1$ symmetry function that Behler introduces in the paper that I have linked above is:

$$
G^1_i = \sum_{j \ne i} f_c(R_{ij})
$$

In this expression, $f_c$ is a switching function and $R_{ij}$ is the distance between atom $i$ and $j$.  We have seen this function already, however, it is just the coordination number.  To calculate it 
using PLUMED we can use the following input.

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/Behler.md_working_1.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="Behler.md_working_1.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="Behler.md_working_1.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/Behler.md_working_1.datcmat" onclick='showPath("data/Behler.md_working_1.dat","data/Behler.md_working_1.datcmat","data/Behler.md_working_1.datcmat","red")'>cmat</b><span style="display:none;" id="data/Behler.md_working_1.datcmat">The CONTACT_MATRIX action with label <b>cmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmat</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONTACT_MATRIX<span class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/CONTACT_MATRIX" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">GROUP<span class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></span></span>=1-100 <span class="plumedtooltip">SWITCH<span class="right">the input for the switching function that acts upon the distance between each pair of atoms. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={CUSTOM R_0=4.5 D_MAX=4.5 FUNC=0.5*(cos(pi*x)+1)}
<span id="data/Behler.md_working_1.datones_short"><b name="data/Behler.md_working_1.datones" onclick='showPath("data/Behler.md_working_1.dat","data/Behler.md_working_1.datones","data/Behler.md_working_1.datones_shortcut","blue")'>ones</b><span style="display:none;" id="data/Behler.md_working_1.datones_shortcut">The ONES action with label <b>ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">ones</td><td width="5%"><font color="blue">vector</font></td><td>a vector of ones with the required number of elements</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/Behler.md_working_1.datones");'>a shortcut</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ONES">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=100
</span><span id="data/Behler.md_working_1.datones_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/Behler.md_working_1.datones")'># ones: ONES SIZE=100</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/Behler.md_working_1.datones" onclick='showPath("data/Behler.md_working_1.dat","data/Behler.md_working_1.datones","data/Behler.md_working_1.datones","blue")'>ones</b><span style="display:none;" id="data/Behler.md_working_1.datones">The CONSTANT action with label <b>ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">ones</td><td width="5%"><font color="blue">vector</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">NOLOG<span class="right"> do not report all the read in scalars in the log<i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
<span style="color:blue"># --- End of included input --- </span></span><b name="data/Behler.md_working_1.datg1" onclick='showPath("data/Behler.md_working_1.dat","data/Behler.md_working_1.datg1","data/Behler.md_working_1.datg1","blue")'>g1</b><span style="display:none;" id="data/Behler.md_working_1.datg1">The MATRIX_VECTOR_PRODUCT action with label <b>g1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g1</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_VECTOR_PRODUCT<span class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_VECTOR_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></span></span>=<b name="data/Behler.md_working_1.datcmat">cmat</b>,<b name="data/Behler.md_working_1.datones">ones</b>
<span style="color:blue" class="comment"># This will print out the 100 coordination number values calculated by the input above.</span>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_1.datg1">g1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=colvar
</pre>
 {% endraw %} 

We have thus already implemented the first of Behler's symmetry functions.

## Implmenting radial symmetry functions

The $G^2$ and $G^3$ symmetry functions that Behler introduces in his paper are:

$$
G^2_i = \sum_{j \ne i} e^{-\nu(R_{ij} -R_s)^2} f_c(R_{ij}) \qquad \textrm{and} \qquad G^3_i = \sum_{j \ne i} \cos(\kappa R_{ij}) f_c(R_{ij})
$$

$\nu$, $R_s$ and $\kappa$ here are parameters, while $f_c$ is a switching function that acts on the distance $R_{ij}$ between atom $i$ and $j$.
In calculating these two functions we need to do a sum of a function of all the $R_{ij}$ values.  We thus have everything we need to calculate 
these variables within PLUMED and need to implement nothing new.  We can simply use the following code to compute $G^2$ and $G^3$ with $\nu=1$, $r_s=3$ and $\kappa=1$:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/Behler.md_working_2.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="Behler.md_working_2.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="Behler.md_working_2.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment"># Calculate the contact matrix.  Element i,j of this matrix tells you if atoms i and j are within a certain cutoff of each other</span>
<b name="data/Behler.md_working_2.datcmat" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datcmat","data/Behler.md_working_2.datcmat","red")'>cmat</b><span style="display:none;" id="data/Behler.md_working_2.datcmat">The CONTACT_MATRIX action with label <b>cmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmat.w</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr><tr><td width="5%">cmat.x</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the x axis</td></tr><tr><td width="5%">cmat.y</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the y axis</td></tr><tr><td width="5%">cmat.z</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the z axis</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONTACT_MATRIX<span class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/CONTACT_MATRIX" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">GROUP<span class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></span></span>=1-100 <span class="plumedtooltip">COMPONENTS<span class="right"> also calculate the components of the vector connecting the atoms in the contact matrix<i></i></span></span> <span class="plumedtooltip">SWITCH<span class="right">the input for the switching function that acts upon the distance between each pair of atoms. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={CUSTOM R_0=4.5 D_MAX=4.5 FUNC=0.5*(cos(pi*x)+1)}
<span style="color:blue" class="comment"># Now calculate a matrix with all the R_ij values</span>
<b name="data/Behler.md_working_2.datcmatr" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datcmatr","data/Behler.md_working_2.datcmatr","red")'>cmatr</b><span style="display:none;" id="data/Behler.md_working_2.datcmatr">The CUSTOM action with label <b>cmatr</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmatr</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_2.datcmat">cmat.x</b>,<b name="data/Behler.md_working_2.datcmat">cmat.y</b>,<b name="data/Behler.md_working_2.datcmat">cmat.z</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=sqrt(x*x+y*y+z*z) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># Compute the quantity in the summation in the expression for G^2.  The output here is a 100x100 matrix.</span>
<b name="data/Behler.md_working_2.datg2_f" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datg2_f","data/Behler.md_working_2.datg2_f","red")'>g2_f</b><span style="display:none;" id="data/Behler.md_working_2.datg2_f">The CUSTOM action with label <b>g2_f</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g2_f</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_2.datcmatr">cmatr</b>,<b name="data/Behler.md_working_2.datcmat">cmat.w</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=y*exp(-(x-3)^2) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># Compute the quantity in the summation in the expression for G^3.  The output here is a 100x100 matrix.</span>
<b name="data/Behler.md_working_2.datg3_f" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datg3_f","data/Behler.md_working_2.datg3_f","red")'>g3_f</b><span style="display:none;" id="data/Behler.md_working_2.datg3_f">The CUSTOM action with label <b>g3_f</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g3_f</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_2.datcmatr">cmatr</b>,<b name="data/Behler.md_working_2.datcmat">cmat.w</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=y*cos(x) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># Now multply the matrices above by a vector of all ones to do the summations</span>
<span id="data/Behler.md_working_2.datones_short"><b name="data/Behler.md_working_2.datones" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datones","data/Behler.md_working_2.datones_shortcut","blue")'>ones</b><span style="display:none;" id="data/Behler.md_working_2.datones_shortcut">The ONES action with label <b>ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">ones</td><td width="5%"><font color="blue">vector</font></td><td>a vector of ones with the required number of elements</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/Behler.md_working_2.datones");'>a shortcut</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ONES">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=100
</span><span id="data/Behler.md_working_2.datones_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/Behler.md_working_2.datones")'># ones: ONES SIZE=100</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/Behler.md_working_2.datones" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datones","data/Behler.md_working_2.datones","blue")'>ones</b><span style="display:none;" id="data/Behler.md_working_2.datones">The CONSTANT action with label <b>ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">ones</td><td width="5%"><font color="blue">vector</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">NOLOG<span class="right"> do not report all the read in scalars in the log<i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
<span style="color:blue"># --- End of included input --- </span></span><b name="data/Behler.md_working_2.datg2" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datg2","data/Behler.md_working_2.datg2","blue")'>g2</b><span style="display:none;" id="data/Behler.md_working_2.datg2">The MATRIX_VECTOR_PRODUCT action with label <b>g2</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g2</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_VECTOR_PRODUCT<span class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_VECTOR_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></span></span>=<b name="data/Behler.md_working_2.datg2_f">g2_f</b>,<b name="data/Behler.md_working_2.datones">ones</b>
<b name="data/Behler.md_working_2.datg3" onclick='showPath("data/Behler.md_working_2.dat","data/Behler.md_working_2.datg3","data/Behler.md_working_2.datg3","blue")'>g3</b><span style="display:none;" id="data/Behler.md_working_2.datg3">The MATRIX_VECTOR_PRODUCT action with label <b>g3</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g3</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_VECTOR_PRODUCT<span class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_VECTOR_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></span></span>=<b name="data/Behler.md_working_2.datg3_f">g3_f</b>,<b name="data/Behler.md_working_2.datones">ones</b>
<span style="color:blue" class="comment"># Print out the 100 values for g2</span>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_2.datg2">g2</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=g2_file
<span style="color:blue" class="comment"># Print out the 100 values for g3</span>
<span style="display:none;" id="data/Behler.md_working_2.dat">The PRINT action with label <b></b> calculates something</span><span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_2.datg3">g3</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=g3_file
</pre>
 {% endraw %} 

Notice the flexibility of this implementation for the Behler symmetry function you can basically compute any weighted function of the bond vectors in the first 
coordination sphere using an input like this one.  A similar input (see below) could be used to calculate the FCC cubic parameter:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/Behler.md_working_3.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="Behler.md_working_3.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="Behler.md_working_3.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment"># Calculate the contact matrix.  Element i,j of this matrix tells you if atoms i and j are within a certain cutoff of each other</span>
<b name="data/Behler.md_working_3.datcmat" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datcmat","data/Behler.md_working_3.datcmat","red")'>cmat</b><span style="display:none;" id="data/Behler.md_working_3.datcmat">The CONTACT_MATRIX action with label <b>cmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmat.w</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr><tr><td width="5%">cmat.x</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the x axis</td></tr><tr><td width="5%">cmat.y</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the y axis</td></tr><tr><td width="5%">cmat.z</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the z axis</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONTACT_MATRIX<span class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/CONTACT_MATRIX" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">GROUP<span class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></span></span>=1-100 <span class="plumedtooltip">COMPONENTS<span class="right"> also calculate the components of the vector connecting the atoms in the contact matrix<i></i></span></span> <span class="plumedtooltip">SWITCH<span class="right">the input for the switching function that acts upon the distance between each pair of atoms. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={CUSTOM R_0=4.5 D_MAX=4.5 FUNC=0.5*(cos(pi*x)+1)}
<span style="color:blue" class="comment"># Now calculate a matrix with all the R_ij values</span>
<b name="data/Behler.md_working_3.datcmatr" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datcmatr","data/Behler.md_working_3.datcmatr","red")'>cmatr</b><span style="display:none;" id="data/Behler.md_working_3.datcmatr">The CUSTOM action with label <b>cmatr</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmatr</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_3.datcmat">cmat.x</b>,<b name="data/Behler.md_working_3.datcmat">cmat.y</b>,<b name="data/Behler.md_working_3.datcmat">cmat.z</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=sqrt(x*x+y*y+z*z) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># Now calculate the fcc cubic parameter for each bond.  This outputs a matrix</span>
<b name="data/Behler.md_working_3.datfcc_f" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datfcc_f","data/Behler.md_working_3.datfcc_f","red")'>fcc_f</b><span style="display:none;" id="data/Behler.md_working_3.datfcc_f">The CUSTOM action with label <b>fcc_f</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">fcc_f</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_3.datcmat">cmat.x</b>,<b name="data/Behler.md_working_3.datcmat">cmat.y</b>,<b name="data/Behler.md_working_3.datcmat">cmat.z</b>,<b name="data/Behler.md_working_3.datcmatr">cmatr</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=((x^4)*(y^4)+(x^4)*(z^4)+(y^4)*(z^4))/(r^8)-27*(x^4)*(y^4)*(z^4)/(r^12) <span class="plumedtooltip">VAR<span class="right">the names to give each of the arguments in the function<i></i></span></span>=x,y,z,r <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># And multiply the above by the weights to get another 100 x 100 matrix</span>
<b name="data/Behler.md_working_3.datwfcc_f" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datwfcc_f","data/Behler.md_working_3.datwfcc_f","red")'>wfcc_f</b><span style="display:none;" id="data/Behler.md_working_3.datwfcc_f">The CUSTOM action with label <b>wfcc_f</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">wfcc_f</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_3.datfcc_f">fcc_f</b>,<b name="data/Behler.md_working_3.datcmat">cmat.w</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x*y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># Now sum the rows of the matrix above to get a vector with 100 elements.  One symmetry function for each atom. </span>
<span id="data/Behler.md_working_3.datones_short"><b name="data/Behler.md_working_3.datones" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datones","data/Behler.md_working_3.datones_shortcut","blue")'>ones</b><span style="display:none;" id="data/Behler.md_working_3.datones_shortcut">The ONES action with label <b>ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">ones</td><td width="5%"><font color="blue">vector</font></td><td>a vector of ones with the required number of elements</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/Behler.md_working_3.datones");'>a shortcut</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ONES">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=100
</span><span id="data/Behler.md_working_3.datones_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/Behler.md_working_3.datones")'># ones: ONES SIZE=100</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/Behler.md_working_3.datones" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datones","data/Behler.md_working_3.datones","blue")'>ones</b><span style="display:none;" id="data/Behler.md_working_3.datones">The CONSTANT action with label <b>ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">ones</td><td width="5%"><font color="blue">vector</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">NOLOG<span class="right"> do not report all the read in scalars in the log<i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
<span style="color:blue"># --- End of included input --- </span></span><b name="data/Behler.md_working_3.datfcc_u" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datfcc_u","data/Behler.md_working_3.datfcc_u","blue")'>fcc_u</b><span style="display:none;" id="data/Behler.md_working_3.datfcc_u">The MATRIX_VECTOR_PRODUCT action with label <b>fcc_u</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">fcc_u</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_VECTOR_PRODUCT<span class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_VECTOR_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></span></span>=<b name="data/Behler.md_working_3.datwfcc_f">wfcc_f</b>,<b name="data/Behler.md_working_3.datones">ones</b> 
<span style="color:blue" class="comment"># This is the coordination number</span>
<b name="data/Behler.md_working_3.datdenom" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datdenom","data/Behler.md_working_3.datdenom","blue")'>denom</b><span style="display:none;" id="data/Behler.md_working_3.datdenom">The MATRIX_VECTOR_PRODUCT action with label <b>denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">denom</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_VECTOR_PRODUCT<span class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_VECTOR_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></span></span>=<b name="data/Behler.md_working_3.datcmat">cmat.w</b>,<b name="data/Behler.md_working_3.datones">ones</b>
<span style="color:blue" class="comment"># We devide fcc_u by the coordination number to get the average value of the function above for the atoms in the first coordination sphere.</span>
<b name="data/Behler.md_working_3.datfcc" onclick='showPath("data/Behler.md_working_3.dat","data/Behler.md_working_3.datfcc","data/Behler.md_working_3.datfcc","blue")'>fcc</b><span style="display:none;" id="data/Behler.md_working_3.datfcc">The CUSTOM action with label <b>fcc</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">fcc</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of an arbitrary function to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_3.datfcc_u">fcc_u</b>,<b name="data/Behler.md_working_3.datdenom">denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># And finally we print the 100 symmetry function values to a file called colvar.</span>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_3.datfcc">fcc</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=colvar
</pre>
 {% endraw %} 

The code is faster if the calculations that are done with CUSTOM keywords in the input above are implemented directly in C++.  Even so the fact that you can so quickly prototype complicated 
CVs like these is (I hope) useful.

## Implementing angular symmetry functionsa

One of the angular symmetry functions that Behler introduces is:

$$
G^5_i = 2^{1-\zeta} \sum_{j,k\ne i} (1 + \lambda\cos\theta_{ijk})^\zeta e^{-\nu(R_{ij}^2 + R_{ik}^2)} f_c(R_{ij}) f_c(R_{ik})
$$

In this expression $\zeta$, $\nu$ and $\lambda$ are all parameters.  $f_c$ is a switching function which acts upon $R_{ij}$, the distance between atom $i$ and atom $j$, and
$R_{ik}$, the distance between atom $i$ and atom $k$.  $\theta_{ijk}$ is then the angle between the vector that points from atom $i$ to atom $j$ and the vector that points from 
atom $i$ to atom $k$. 

Even this complicated function can be calculated directly in PLUMED.  The input below caluclates the $G^5_i$ value for atom 1 with $\zeta=3$, $\lambda=3 and $\nu=0.1$.

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/Behler.md_working_4.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="Behler.md_working_4.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="Behler.md_working_4.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment"># Calculate the distances between atom one and all the other atoms</span>
<b name="data/Behler.md_working_4.datd1" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1","data/Behler.md_working_4.datd1","blue")'>d1</b><span style="display:none;" id="data/Behler.md_working_4.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="blue">vector</font></td><td>the DISTANCE for each set of specified atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS1<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2 <span class="plumedtooltip">ATOMS2<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,3 <span class="plumedtooltip">ATOMS3<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,4 <span class="plumedtooltip">ATOMS4<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,5 <span class="plumedtooltip">ATOMS5<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,7 <span class="plumedtooltip">ATOMS6<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,8
<span style="color:blue" class="comment"># Now transform the distances above by a switching function</span>
<b name="data/Behler.md_working_4.datd1lt" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1lt","data/Behler.md_working_4.datd1lt","blue")'>d1lt</b><span style="display:none;" id="data/Behler.md_working_4.datd1lt">The LESS_THAN action with label <b>d1lt</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1lt</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of a function that is one if the input is less than a threshold to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">LESS_THAN<span class="right">Use a switching function to determine how many of the input variables are less than a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datd1">d1</b> <span class="plumedtooltip">SWITCH<span class="right">This keyword is used if you want to employ an alternative to the continuous swiching function defined above<i></i></span></span>={CUSTOM R_0=4.5 D_MAX=4.5 FUNC=0.5*(cos(pi*x)+1)}
<span style="color:blue" class="comment"># Calculate the vectors between atom one and all the other atoms</span>
<b name="data/Behler.md_working_4.datd1c" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1c","data/Behler.md_working_4.datd1c","blue")'>d1c</b><span style="display:none;" id="data/Behler.md_working_4.datd1c">The DISTANCE action with label <b>d1c</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1c.x</td><td width="5%"><font color="blue">vector</font></td><td>the x-component of the vector connecting the two atoms</td></tr><tr><td width="5%">d1c.y</td><td width="5%"><font color="blue">vector</font></td><td>the y-component of the vector connecting the two atoms</td></tr><tr><td width="5%">d1c.z</td><td width="5%"><font color="blue">vector</font></td><td>the z-component of the vector connecting the two atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">COMPONENTS<span class="right"> calculate the x, y and z components of the distance separately and store them as label<i></i></span></span> <span class="plumedtooltip">ATOMS1<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2 <span class="plumedtooltip">ATOMS2<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,3 <span class="plumedtooltip">ATOMS3<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,4 <span class="plumedtooltip">ATOMS4<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,5 <span class="plumedtooltip">ATOMS5<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,7 <span class="plumedtooltip">ATOMS6<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,8 
<span style="color:blue" class="comment"># Now calculate the lengths of all the vectors connecting atom 1 to the other atoms</span>
<b name="data/Behler.md_working_4.datd1r2" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1r2","data/Behler.md_working_4.datd1r2","blue")'>d1r2</b><span style="display:none;" id="data/Behler.md_working_4.datd1r2">The COMBINE action with label <b>d1r2</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1r2</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of a linear compbination to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">COMBINE<span class="right">Calculate a polynomial combination of a set of other variables. <a href="https://www.plumed.org/doc-master/user-doc/html/COMBINE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datd1c">d1c.x</b>,<b name="data/Behler.md_working_4.datd1c">d1c.y</b>,<b name="data/Behler.md_working_4.datd1c">d1c.z</b> <span class="plumedtooltip">POWERS<span class="right"> the powers to which you are raising each of the arguments in your function<i></i></span></span>=2,2,2 <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/Behler.md_working_4.datd1r" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1r","data/Behler.md_working_4.datd1r","blue")'>d1r</b><span style="display:none;" id="data/Behler.md_working_4.datd1r">The CUSTOM action with label <b>d1r</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1r</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of an arbitrary function to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datd1r2">d1r2</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=sqrt(x) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># And find unit vectors that connect atom 1 to all its neighbours</span>
<b name="data/Behler.md_working_4.datd1ux" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1ux","data/Behler.md_working_4.datd1ux","blue")'>d1ux</b><span style="display:none;" id="data/Behler.md_working_4.datd1ux">The CUSTOM action with label <b>d1ux</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1ux</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of an arbitrary function to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datd1c">d1c.x</b>,<b name="data/Behler.md_working_4.datd1r">d1r</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/Behler.md_working_4.datd1uy" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1uy","data/Behler.md_working_4.datd1uy","blue")'>d1uy</b><span style="display:none;" id="data/Behler.md_working_4.datd1uy">The CUSTOM action with label <b>d1uy</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1uy</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of an arbitrary function to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datd1c">d1c.y</b>,<b name="data/Behler.md_working_4.datd1r">d1r</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/Behler.md_working_4.datd1uz" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datd1uz","data/Behler.md_working_4.datd1uz","blue")'>d1uz</b><span style="display:none;" id="data/Behler.md_working_4.datd1uz">The CUSTOM action with label <b>d1uz</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1uz</td><td width="5%"><font color="blue">vector</font></td><td>the vector obtained by doing an element-wise application of an arbitrary function to the input vectors</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datd1c">d1c.z</b>,<b name="data/Behler.md_working_4.datd1r">d1r</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO 
<span style="color:blue" class="comment"># And put the three unit vectors into a matrix</span>
<b name="data/Behler.md_working_4.datstack" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datstack","data/Behler.md_working_4.datstack","red")'>stack</b><span style="display:none;" id="data/Behler.md_working_4.datstack">The VSTACK action with label <b>stack</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">stack</td><td width="5%"><font color="red">matrix</font></td><td>a matrix that contains the input vectors in its columns</td></tr></table></span>: <span class="plumedtooltip" style="color:green">VSTACK<span class="right">Create a matrix by stacking vectors together <a href="https://www.plumed.org/doc-master/user-doc/html/VSTACK" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values that you would like to stack together to construct the output matrix<i></i></span></span>=<b name="data/Behler.md_working_4.datd1ux">d1ux</b>,<b name="data/Behler.md_working_4.datd1uz">d1uz</b>,<b name="data/Behler.md_working_4.datd1uz">d1uz</b>
<span style="color:blue" class="comment"># Now create a matrix in which element i,j = f_c(R_ij) f_c(R_ik)</span>
<span id="data/Behler.md_working_4.datdefwmat_short"><b name="data/Behler.md_working_4.datwmat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datwmat","data/Behler.md_working_4.datwmat","red")'>wmat</b><span style="display:none;" id="data/Behler.md_working_4.datwmat">The OUTER_PRODUCT action with label <b>wmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">wmat</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the outer product of the two input vectors that was obtained using the function that was input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">OUTER_PRODUCT<span class="right">Calculate the outer product matrix of two vectors This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/Behler.md_working_4.datdefwmat");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/OUTER_PRODUCT">More details</a><i></i></span></span> <span class="plumedtooltip">ELEMENTS_ON_DIAGONAL_ARE_ZERO<span class="right"> set all diagonal elements to zero<i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the two vectors from which the outer product is being computed<i></i></span></span>=<b name="data/Behler.md_working_4.datd1lt">d1lt</b>,<b name="data/Behler.md_working_4.datd1lt">d1lt</b>
</span><span id="data/Behler.md_working_4.datdefwmat_long" style="display:none;"><b name="data/Behler.md_working_4.datwmat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datwmat","data/Behler.md_working_4.datwmat","red")'>wmat</b>: <span class="plumedtooltip" style="color:green">OUTER_PRODUCT<span class="right">Calculate the outer product matrix of two vectors This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/Behler.md_working_4.datdefwmat");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/OUTER_PRODUCT">More details</a><i></i></span></span> <span class="plumedtooltip">ELEMENTS_ON_DIAGONAL_ARE_ZERO<span class="right"> set all diagonal elements to zero<i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the two vectors from which the outer product is being computed<i></i></span></span>=<b name="data/Behler.md_working_4.datd1lt">d1lt</b>,<b name="data/Behler.md_working_4.datd1lt">d1lt</b>  <span class="plumedtooltip">FUNC<span class="right"> the function of the input vectors that should be put in the elements of the outer product<i></i></span></span>=x*y
</span><span style="color:blue" class="comment"># And a matrix containing the cosines of the angles between the two vectors</span>
<b name="data/Behler.md_working_4.datstackT" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datstackT","data/Behler.md_working_4.datstackT","red")'>stackT</b><span style="display:none;" id="data/Behler.md_working_4.datstackT">The TRANSPOSE action with label <b>stackT</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">stackT</td><td width="5%"><font color="red">matrix</font></td><td>the transpose of the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">TRANSPOSE<span class="right">Calculate the transpose of a matrix <a href="https://www.plumed.org/doc-master/user-doc/html/TRANSPOSE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the vector or matrix that should be transposed<i></i></span></span>=<b name="data/Behler.md_working_4.datstack">stack</b>
<b name="data/Behler.md_working_4.datcmat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datcmat","data/Behler.md_working_4.datcmat","red")'>cmat</b><span style="display:none;" id="data/Behler.md_working_4.datcmat">The MATRIX_PRODUCT action with label <b>cmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmat</td><td width="5%"><font color="red">matrix</font></td><td>the product of the two input matrices</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_PRODUCT<span class="right">Calculate the product of two matrices <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the two matrices from which the product is calculated<i></i></span></span>=<b name="data/Behler.md_working_4.datstack">stack</b>,<b name="data/Behler.md_working_4.datstackT">stackT</b>
<span style="color:blue" class="comment"># Now compute a matrix containing (1 + \lambda cos(\theta_ijk))^3</span>
<b name="data/Behler.md_working_4.datpmat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datpmat","data/Behler.md_working_4.datpmat","red")'>pmat</b><span style="display:none;" id="data/Behler.md_working_4.datpmat">The CUSTOM action with label <b>pmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">pmat</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datcmat">cmat</b> <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=(1+3*cos(x))^3 
<span style="color:blue" class="comment"># And a matrix containing in which element j,k is R_ij^2 + R_ik^2 </span>
<b name="data/Behler.md_working_4.datsmat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datsmat","data/Behler.md_working_4.datsmat","red")'>smat</b><span style="display:none;" id="data/Behler.md_working_4.datsmat">The OUTER_PRODUCT action with label <b>smat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">smat</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the outer product of the two input vectors that was obtained using the function that was input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">OUTER_PRODUCT<span class="right">Calculate the outer product matrix of two vectors <a href="https://www.plumed.org/doc-master/user-doc/html/OUTER_PRODUCT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the two vectors from which the outer product is being computed<i></i></span></span>=<b name="data/Behler.md_working_4.datd1r2">d1r2</b>,<b name="data/Behler.md_working_4.datd1r2">d1r2</b> <span class="plumedtooltip">FUNC<span class="right"> the function of the input vectors that should be put in the elements of the outer product<i></i></span></span>=x+y 
<span style="color:blue" class="comment"># Now take the exponential of this matrix</span>
<b name="data/Behler.md_working_4.datemat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datemat","data/Behler.md_working_4.datemat","red")'>emat</b><span style="display:none;" id="data/Behler.md_working_4.datemat">The CUSTOM action with label <b>emat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">emat</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datsmat">smat</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=exp(-0.1*x) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># And combine everything to get G^5</span>
<b name="data/Behler.md_working_4.datg5mat" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datg5mat","data/Behler.md_working_4.datg5mat","red")'>g5mat</b><span style="display:none;" id="data/Behler.md_working_4.datg5mat">The CUSTOM action with label <b>g5mat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g5mat</td><td width="5%"><font color="red">matrix</font></td><td>the matrix obtained by doing an element-wise application of an arbitrary function to the input matrix</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datcmat">cmat</b>,<b name="data/Behler.md_working_4.datemat">emat</b>,<b name="data/Behler.md_working_4.datwmat">wmat</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x*y*z <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># Now sum all the elements of g5mat</span>
<b name="data/Behler.md_working_4.datg5s" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datg5s","data/Behler.md_working_4.datg5s","black")'>g5s</b><span style="display:none;" id="data/Behler.md_working_4.datg5s">The SUM action with label <b>g5s</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g5s</td><td width="5%"><font color="black">scalar</font></td><td>the SUM of the elements in the input value</td></tr></table></span>: <span class="plumedtooltip" style="color:green">SUM<span class="right">Calculate the sum of the arguments <a href="https://www.plumed.org/doc-master/user-doc/html/SUM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the vector/matrix/grid whose elements shuld be added together<i></i></span></span>=<b name="data/Behler.md_working_4.datg5mat">g5mat</b> <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># And multiply by 0.5 and 2^{1-\zeta}.  We need to multiply by 0.5 here to avoid double counting</span>
<b name="data/Behler.md_working_4.datg5" onclick='showPath("data/Behler.md_working_4.dat","data/Behler.md_working_4.datg5","data/Behler.md_working_4.datg5","black")'>g5</b><span style="display:none;" id="data/Behler.md_working_4.datg5">The CUSTOM action with label <b>g5</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">g5</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/Behler.md_working_4.datg5s">g5s</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=0.5*0.25*x <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue" class="comment"># And print the final scalar to a file</span>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_4.datg5">g5</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=colvar
</pre>
 {% endraw %} 

This input computes $G^5$ for a single atom and is rather cumbersome.  The calculation here is not particularly well optimised as we have to calculate the distance between atom 
1 and all the other atoms.  In other words, when an input similar to this one is used PLUMED is not using link cells or neighbour lists to optimse the calculation.  This way of 
implementing $G^5$ is thus not really suited to production applications.  I thus wrote a second implementation of the $G^5$ function.  The input for this alternative implementation is 
as follows:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/Behler.md_working_5.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="Behler.md_working_5.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="Behler.md_working_5.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment"># Calculate the contact matrix and the x,y and z components of the bond vectors</span>
<span style="color:blue" class="comment"># This action calculates 4 100x100 matrices</span>
<b name="data/Behler.md_working_5.datcmat" onclick='showPath("data/Behler.md_working_5.dat","data/Behler.md_working_5.datcmat","data/Behler.md_working_5.datcmat","red")'>cmat</b><span style="display:none;" id="data/Behler.md_working_5.datcmat">The CONTACT_MATRIX action with label <b>cmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmat.w</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr><tr><td width="5%">cmat.x</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the x axis</td></tr><tr><td width="5%">cmat.y</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the y axis</td></tr><tr><td width="5%">cmat.z</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the z axis</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONTACT_MATRIX<span class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/CONTACT_MATRIX" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">GROUP<span class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></span></span>=1-100 <span class="plumedtooltip">SWITCH<span class="right">the input for the switching function that acts upon the distance between each pair of atoms. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={CUSTOM R_0=4.5 D_MAX=4.5 FUNC=0.5*(cos(pi*x)+1)} <span class="plumedtooltip">COMPONENTS<span class="right"> also calculate the components of the vector connecting the atoms in the contact matrix<i></i></span></span>
<br/><span style="color:blue" class="comment"># Compute the symmetry function for the 100 atoms from the 4 100x100 matrices output</span>
<span style="color:blue" class="comment"># by cmat.  The output from this action is a vector with 100 elements</span>
<b name="data/Behler.md_working_5.datbeh3" onclick='showPath("data/Behler.md_working_5.dat","data/Behler.md_working_5.datbeh3","data/Behler.md_working_5.datbeh3","blue")'>beh3</b><span style="display:none;" id="data/Behler.md_working_5.datbeh3">The GSYMFUNC_THREEBODY action with label <b>beh3</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">beh3.g5</td><td width="5%"><font color="blue">vector</font></td><td>the function defined by the FUNCTION1 keyword</td></tr></table></span>: <span class="plumedtooltip" style="color:green">GSYMFUNC_THREEBODY<span class="right">Calculate functions of the coordinates of the coordinates of all pairs of bonds in the first coordination sphere of an atom <a href="https://www.plumed.org/doc-master/user-doc/html/GSYMFUNC_THREEBODY" style="color:green">More details</a><i></i></span></span> ...
    <span class="plumedtooltip">WEIGHT<span class="right">the matrix that contains the weights that should be used for each connection<i></i></span></span>=<b name="data/Behler.md_working_5.datcmat">cmat.w</b> <span class="plumedtooltip">ARG<span class="right">three matrices containing the bond vectors of interest<i></i></span></span>=<b name="data/Behler.md_working_5.datcmat">cmat.x</b>,<b name="data/Behler.md_working_5.datcmat">cmat.y</b>,<b name="data/Behler.md_working_5.datcmat">cmat.z</b>
    <span class="plumedtooltip">FUNCTION1<span class="right">the parameters of the function you would like to compute<i></i></span></span>={FUNC=0.25*exp(-0.1*(rij+rik))*(1+3*cos(ajik))^3 LABEL=g5}
...
<br/><span style="color:blue" class="comment"># Print the 100 symmetry function values to a file</span>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_5.datbeh3">beh3.g5</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=colvar
</pre>
 {% endraw %} 

The GSYMFUNC_THREEBODY action sums over all the distinct triples of atoms that are identified in the contact matrix.  This action auses lepton and can thus compute any 
function of the following four quantities:

* `rij` - the distance between atom $i$ and atom $j$
* `rik` - the distance between atom $i$ and atom $k$
* `rjk` - the distance between atom $j$ and atom $k$
* `ajik` - the angle between the vector connecting atom $i$ to atom $j$ and the vector connecting atom $i$ to atom $k$.

Furthermore we can calculate more than one function of these four quantities at a time as illustrated by the input below:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/Behler.md_working_6.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="Behler.md_working_6.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="Behler.md_working_6.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment"># Calculate the contact matrix and the x,y and z components of the bond vectors</span>
<span style="color:blue" class="comment"># This action calculates 4 100x100 matrices</span>
<b name="data/Behler.md_working_6.datcmat" onclick='showPath("data/Behler.md_working_6.dat","data/Behler.md_working_6.datcmat","data/Behler.md_working_6.datcmat","red")'>cmat</b><span style="display:none;" id="data/Behler.md_working_6.datcmat">The CONTACT_MATRIX action with label <b>cmat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">cmat.w</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr><tr><td width="5%">cmat.x</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the x axis</td></tr><tr><td width="5%">cmat.y</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the y axis</td></tr><tr><td width="5%">cmat.z</td><td width="5%"><font color="red">matrix</font></td><td>the projection of the bond on the z axis</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONTACT_MATRIX<span class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/CONTACT_MATRIX" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">GROUP<span class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></span></span>=1-100 <span class="plumedtooltip">SWITCH<span class="right">the input for the switching function that acts upon the distance between each pair of atoms. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={CUSTOM R_0=4.5 D_MAX=4.5 FUNC=0.5*(cos(pi*x)+1)} <span class="plumedtooltip">COMPONENTS<span class="right"> also calculate the components of the vector connecting the atoms in the contact matrix<i></i></span></span>
<br/><span style="color:blue" class="comment"># Compute the 4 symmetry function below for the 100 atoms from the 4 100x100 matrices output</span>
<span style="color:blue" class="comment"># by cmat.  The output from this action is a vector with 100 elements</span>
<b name="data/Behler.md_working_6.datbeh3" onclick='showPath("data/Behler.md_working_6.dat","data/Behler.md_working_6.datbeh3","data/Behler.md_working_6.datbeh3","blue")'>beh3</b><span style="display:none;" id="data/Behler.md_working_6.datbeh3">The GSYMFUNC_THREEBODY action with label <b>beh3</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">beh3.g4</td><td width="5%"><font color="blue">vector</font></td><td>the function defined by the FUNCTION1 keyword</td></tr><tr><td width="5%">beh3.g5</td><td width="5%"><font color="blue">vector</font></td><td>the function defined by the FUNCTION2 keyword</td></tr><tr><td width="5%">beh3.g6</td><td width="5%"><font color="blue">vector</font></td><td>the function defined by the FUNCTION3 keyword</td></tr><tr><td width="5%">beh3.g7</td><td width="5%"><font color="blue">vector</font></td><td>the function defined by the FUNCTION4 keyword</td></tr></table></span>: <span class="plumedtooltip" style="color:green">GSYMFUNC_THREEBODY<span class="right">Calculate functions of the coordinates of the coordinates of all pairs of bonds in the first coordination sphere of an atom <a href="https://www.plumed.org/doc-master/user-doc/html/GSYMFUNC_THREEBODY" style="color:green">More details</a><i></i></span></span> ...
    <span class="plumedtooltip">WEIGHT<span class="right">the matrix that contains the weights that should be used for each connection<i></i></span></span>=<b name="data/Behler.md_working_6.datcmat">cmat.w</b> <span class="plumedtooltip">ARG<span class="right">three matrices containing the bond vectors of interest<i></i></span></span>=<b name="data/Behler.md_working_6.datcmat">cmat.x</b>,<b name="data/Behler.md_working_6.datcmat">cmat.y</b>,<b name="data/Behler.md_working_6.datcmat">cmat.z</b>
    <span class="plumedtooltip">FUNCTION1<span class="right">the parameters of the function you would like to compute<i></i></span></span>={FUNC=0.25*(cos(pi*sqrt(rjk)/4.5)+1)*exp(-0.1*(rij+rik+rjk))*(1+2*cos(ajik))^2 LABEL=g4}
    <span class="plumedtooltip">FUNCTION2<span class="right">the parameters of the function you would like to compute<i></i></span></span>={FUNC=0.25*exp(-0.1*(rij+rik))*(1+3.5*cos(ajik))^3 LABEL=g5}
    <span class="plumedtooltip">FUNCTION3<span class="right">the parameters of the function you would like to compute<i></i></span></span>={FUNC=0.125*(1+6.6*cos(ajik))^4 LABEL=g6}
    <span class="plumedtooltip">FUNCTION4<span class="right">the parameters of the function you would like to compute<i></i></span></span>={FUNC=sin(3.0*(ajik-1)) LABEL=g7}
...
<br/><span style="color:blue" class="comment"># Print the 4 sets of 100 symmetry function values to a file</span>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/Behler.md_working_6.datbeh3">beh3.g4</b>,<b name="data/Behler.md_working_6.datbeh3">beh3.g5</b>,<b name="data/Behler.md_working_6.datbeh3">beh3.g6</b>,<b name="data/Behler.md_working_6.datbeh3">beh3.g7</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=colvar
</pre>
 {% endraw %} 

As we saw for the radial symmetry function, we thus again have an implementation of these angular symmetry functions that can be quickly used to prototype new function types.

## Conclusions

I hope the examples above have convinced you that the PLUMED input file now provides the flexibility required to prototype CVs that are really rather complicated.  Using 
CUSTOM actions when implementing these CVs is probably not optimal when it comes to computational performance but I am not convinced that this matters.  I think our objective should always be to have
less code as this makes PLUMED easier to maintain.  

It is also the case that many of the CVs that are implemented in PLUMED are not used by many people.  The understanding of what particular actions do is thus lost with time.  When CVs are implemented in 
the way above the series of action that are performed within them are more transparent.  This transparency allows allows other to understand what has been done in the past and reduces the requirements to 
write large amounts of documentation.  

Lastly, if users need code that runs faster they can always reimplement expensive CVs that are implemented in PLUMED.  Furthermore, in any effort to reimplement CVs they are helped
by the fact that PLUMED offers reference values that they can test their new code against.
