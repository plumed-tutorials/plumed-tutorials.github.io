# Calculating averages

The final result that is extracted from a molecular dynamics simulation is an average.  In other words, molecular dynamics (like Monte Carlo) is a method for generating multiple samples
of a random variable so that one can take an average.  This average then provides an estimate for a physical observable, which should really be calculated by computing the ensemble average.

When we run molecular dynamics simulations there are three methods that we can use to generate the multiple samples that are used to calculate these averages:

1. We can calculate observables for each of the microstates in the trajectory and take a time average.
2. We can have multiple indistinguishable representations of the quantity of interest in each microstate we generate.  We can thus perform a spatial average over these indistinguishable entities.
3. We can run multiple trajectories in parallel and then average over these distinct replicas of the whole physical system.

The various methods that are implemented in PLUMED combine these three types of averaging in a myriad of different ways. To make the code more transparent I have thus tried to separate these various
ways of collecting data for averaging.  My hope that these separate actions can be used when implementing new methods for calculating averages and that the resulting code will provide a more transparent
explanation of the similarities and differences between all these methods.  Obviously, shortcut actions can be used to enusre that the complex inputs that are actually used to run the various methods are generated
correctly.  My hope, however, is that if folks are willing to use shortcuts when implementing new methods we can generate rich documentation that illustrates how the averages that are used in the simulations
are generated from the trajectory.  This documentation will, I hope, help users to better understand the theory behind the methods that they are employing and encourage cross-fertilisation of ideas between 
developers of different methods.

With all that in mind, allow me to explain here how the three forms of averaging described above are implemented in PLUMED.

## Unbiased time averages

Lets start with simple PLUMED input. The input below calculates and prints the time average of the distance between atom 1 and 2 to a file called average.

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_1.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_1.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_1.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_1.datd1" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.datd1","data/averaging.md_working_1.datd1","black")'>d1</b><span style="display:none;" id="data/averaging.md_working_1.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2
<span id="data/averaging.md_working_1.data1_short"><span id="data/averaging.md_working_1.datdefa1_short"><b name="data/averaging.md_working_1.data1" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1","data/averaging.md_working_1.data1_shortcut","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_1.data1_shortcut">The AVERAGE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>the value of the average</td></tr></table></span>: <span class="plumedtooltip" style="color:green">AVERAGE<span class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_1.data1");'>a shortcut</a> and it has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_1.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/AVERAGE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the quantity that is being averaged<i></i></span></span>=<b name="data/averaging.md_working_1.datd1">d1</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which to store data for averaging<i></i></span></span>=1
</span><span id="data/averaging.md_working_1.datdefa1_long" style="display:none;"><b name="data/averaging.md_working_1.data1" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1","data/averaging.md_working_1.data1_shortcut","black")'>a1</b>: <span class="plumedtooltip" style="color:green">AVERAGE<span class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_1.data1");'>a shortcut</a> and uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_1.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/AVERAGE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the quantity that is being averaged<i></i></span></span>=<b name="data/averaging.md_working_1.datd1">d1</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which to store data for averaging<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with whihc to clear the data that is being averaged<i></i></span></span>=0
</span></span><span id="data/averaging.md_working_1.data1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/averaging.md_working_1.data1")'># a1: AVERAGE ARG=d1 STRIDE=1</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/averaging.md_working_1.data1_weight" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1_weight","data/averaging.md_working_1.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_1.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/ONES" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=1
<b name="data/averaging.md_working_1.data1_denom" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1_denom","data/averaging.md_working_1.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_1.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_1.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_1.data1_prod" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1_prod","data/averaging.md_working_1.data1_prod","black")'>a1_prod</b><span style="display:none;" id="data/averaging.md_working_1.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_1.datd1">d1</b>,<b name="data/averaging.md_working_1.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x*y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/averaging.md_working_1.data1_numer" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1_numer","data/averaging.md_working_1.data1_numer","black")'>a1_numer</b><span style="display:none;" id="data/averaging.md_working_1.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_1.data1_prod">a1_prod</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_1.data1" onclick='showPath("data/averaging.md_working_1.dat","data/averaging.md_working_1.data1","data/averaging.md_working_1.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_1.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_1.data1_numer">a1_numer</b>,<b name="data/averaging.md_working_1.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue"># --- End of included input --- </span></span><span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_1.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

As the stride is set equal to one on the AVERAGE line samples are taken from every microstate that is visited in the trajectory.  If we had used the following input:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_2.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_2.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_2.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_2.datd1" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.datd1","data/averaging.md_working_2.datd1","black")'>d1</b><span style="display:none;" id="data/averaging.md_working_2.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2
<span id="data/averaging.md_working_2.data1_short"><span id="data/averaging.md_working_2.datdefa1_short"><b name="data/averaging.md_working_2.data1" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1","data/averaging.md_working_2.data1_shortcut","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_2.data1_shortcut">The AVERAGE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>the value of the average</td></tr></table></span>: <span class="plumedtooltip" style="color:green">AVERAGE<span class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_2.data1");'>a shortcut</a> and it has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_2.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/AVERAGE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the quantity that is being averaged<i></i></span></span>=<b name="data/averaging.md_working_2.datd1">d1</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which to store data for averaging<i></i></span></span>=10
</span><span id="data/averaging.md_working_2.datdefa1_long" style="display:none;"><b name="data/averaging.md_working_2.data1" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1","data/averaging.md_working_2.data1_shortcut","black")'>a1</b>: <span class="plumedtooltip" style="color:green">AVERAGE<span class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_2.data1");'>a shortcut</a> and uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_2.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/AVERAGE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the quantity that is being averaged<i></i></span></span>=<b name="data/averaging.md_working_2.datd1">d1</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which to store data for averaging<i></i></span></span>=10  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with whihc to clear the data that is being averaged<i></i></span></span>=0
</span></span><span id="data/averaging.md_working_2.data1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/averaging.md_working_2.data1")'># a1: AVERAGE ARG=d1 STRIDE=10</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/averaging.md_working_2.data1_weight" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1_weight","data/averaging.md_working_2.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_2.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/ONES" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=1
<b name="data/averaging.md_working_2.data1_denom" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1_denom","data/averaging.md_working_2.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_2.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_2.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=10 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_2.data1_prod" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1_prod","data/averaging.md_working_2.data1_prod","black")'>a1_prod</b><span style="display:none;" id="data/averaging.md_working_2.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_2.datd1">d1</b>,<b name="data/averaging.md_working_2.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x*y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/averaging.md_working_2.data1_numer" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1_numer","data/averaging.md_working_2.data1_numer","black")'>a1_numer</b><span style="display:none;" id="data/averaging.md_working_2.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_2.data1_prod">a1_prod</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=10 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_2.data1" onclick='showPath("data/averaging.md_working_2.dat","data/averaging.md_working_2.data1","data/averaging.md_working_2.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_2.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_2.data1_numer">a1_numer</b>,<b name="data/averaging.md_working_2.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span style="color:blue"># --- End of included input --- </span></span><span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_2.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

We would only accumulate averages on every 10th step.  We are still printing a1 on every step, however.  We would thus find that the values of a1 that are printed out on steps
10,11,12,13,14,15,16,17,18 and 19 were all the same.  No additional samples were added on these steps so the average is unchanged.

The input for the AVERAGE action is the same as it was before we merged all the new code I have been working on.  This action is now a shortcut, however.  The full input for the first of the two 
inputs above is:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_3.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_3.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_3.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_3.datd1" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.datd1","data/averaging.md_working_3.datd1","black")'>d1</b><span style="display:none;" id="data/averaging.md_working_3.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2
<span id="data/averaging.md_working_3.datdefa1_weight_short"><b name="data/averaging.md_working_3.data1_weight" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_weight","data/averaging.md_working_3.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_3.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_3.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1
</span><span id="data/averaging.md_working_3.datdefa1_weight_long" style="display:none;"><b name="data/averaging.md_working_3.data1_weight" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_weight","data/averaging.md_working_3.data1_weight","black")'>a1_weight</b>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_3.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1  <span class="plumedtooltip">NROWS<span class="right"> the number of rows in your input matrix<i></i></span></span>=0 <span class="plumedtooltip">NCOLS<span class="right"> the number of columns in your matrix<i></i></span></span>=0
</span><b name="data/averaging.md_working_3.data1_prod" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_prod","data/averaging.md_working_3.data1_prod","black")'>a1_prod</b><span style="display:none;" id="data/averaging.md_working_3.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_3.datd1">d1</b>,<b name="data/averaging.md_working_3.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x*y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span id="data/averaging.md_working_3.datdefa1_denom_short"><b name="data/averaging.md_working_3.data1_denom" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_denom","data/averaging.md_working_3.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_3.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_3.datdefa1_denom");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_3.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_3.datdefa1_denom_long" style="display:none;"><b name="data/averaging.md_working_3.data1_denom" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_denom","data/averaging.md_working_3.data1_denom","black")'>a1_denom</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_3.datdefa1_denom");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_3.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><span id="data/averaging.md_working_3.datdefa1_numer_short"><b name="data/averaging.md_working_3.data1_numer" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_numer","data/averaging.md_working_3.data1_numer","black")'>a1_numer</b><span style="display:none;" id="data/averaging.md_working_3.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_3.datdefa1_numer");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_3.data1_prod">a1_prod</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_3.datdefa1_numer_long" style="display:none;"><b name="data/averaging.md_working_3.data1_numer" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1_numer","data/averaging.md_working_3.data1_numer","black")'>a1_numer</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_3.datdefa1_numer");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_3.data1_prod">a1_prod</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><b name="data/averaging.md_working_3.data1" onclick='showPath("data/averaging.md_working_3.dat","data/averaging.md_working_3.data1","data/averaging.md_working_3.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_3.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_3.data1_numer">a1_numer</b>,<b name="data/averaging.md_working_3.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_3.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

Notice that the non-standard action that is used here is the one called ACCUMULATE.  This action simply adds together the instantaneous values that are passed to it.  You can use this action to 
do a sum over a time series.  The rest of the averaging operation is done with CUSTOM actions.  You can also hopefully see how the input above can easily be modified so that you can calculate 
an average from a biased simulation.  In that case you simply need to modify the input for the a1_weight command in a way that accounts for the reweighting that must be done on the biased simulation.

Notice that it is also easier to explain how block averages are computed with this input.  When describing an input like this one:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_4.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_4.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_4.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_4.datd1" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.datd1","data/averaging.md_working_4.datd1","black")'>d1</b><span style="display:none;" id="data/averaging.md_working_4.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2
<span id="data/averaging.md_working_4.datdefa1_weight_short"><b name="data/averaging.md_working_4.data1_weight" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.data1_weight","data/averaging.md_working_4.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_4.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_4.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1
</span><span id="data/averaging.md_working_4.datdefa1_weight_long" style="display:none;"><b name="data/averaging.md_working_4.data1_weight" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.data1_weight","data/averaging.md_working_4.data1_weight","black")'>a1_weight</b>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_4.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1  <span class="plumedtooltip">NROWS<span class="right"> the number of rows in your input matrix<i></i></span></span>=0 <span class="plumedtooltip">NCOLS<span class="right"> the number of columns in your matrix<i></i></span></span>=0
</span><b name="data/averaging.md_working_4.data1_prod" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.data1_prod","data/averaging.md_working_4.data1_prod","black")'>a1_prod</b><span style="display:none;" id="data/averaging.md_working_4.data1_prod">The CUSTOM action with label <b>a1_prod</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_prod</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_4.datd1">d1</b>,<b name="data/averaging.md_working_4.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x*y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/averaging.md_working_4.data1_denom" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.data1_denom","data/averaging.md_working_4.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_4.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_4.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=100
<b name="data/averaging.md_working_4.data1_numer" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.data1_numer","data/averaging.md_working_4.data1_numer","black")'>a1_numer</b><span style="display:none;" id="data/averaging.md_working_4.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_4.data1_prod">a1_prod</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=100
<b name="data/averaging.md_working_4.data1" onclick='showPath("data/averaging.md_working_4.dat","data/averaging.md_working_4.data1","data/averaging.md_working_4.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_4.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_4.data1_numer">a1_numer</b>,<b name="data/averaging.md_working_4.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_4.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

You simply state that the CLEAR=100 keywords ensure that a1_denom and a1_numer are set equal to zero on every hundreth step. 

Lastly, note that, because we are using shortcuts, we can show users what is done for special cases.  To see what I mean consider the following input:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_5.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_5.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_5.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_5.datt1" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.datt1","data/averaging.md_working_5.datt1","black")'>t1</b><span style="display:none;" id="data/averaging.md_working_5.datt1">The TORSION action with label <b>t1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1</td><td width="5%"><font color="black">scalar</font></td><td>the TORSION involving these atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">TORSION<span class="right">Calculate one or multiple torsional angles. <a href="https://www.plumed.org/doc-master/user-doc/html/TORSION" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the four atoms involved in the torsional angle<i></i></span></span>=1,2,3,4
<span id="data/averaging.md_working_5.data1_short"><span id="data/averaging.md_working_5.datdefa1_short"><b name="data/averaging.md_working_5.data1" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1","data/averaging.md_working_5.data1_shortcut","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_5.data1_shortcut">The AVERAGE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>the value of the average</td></tr></table></span>: <span class="plumedtooltip" style="color:green">AVERAGE<span class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_5.data1");'>a shortcut</a> and it has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_5.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/AVERAGE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the quantity that is being averaged<i></i></span></span>=<b name="data/averaging.md_working_5.datt1">t1</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which to store data for averaging<i></i></span></span>=1
</span><span id="data/averaging.md_working_5.datdefa1_long" style="display:none;"><b name="data/averaging.md_working_5.data1" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1","data/averaging.md_working_5.data1_shortcut","black")'>a1</b>: <span class="plumedtooltip" style="color:green">AVERAGE<span class="right">Calculate the ensemble average of a collective variable This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_5.data1");'>a shortcut</a> and uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_5.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/AVERAGE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the quantity that is being averaged<i></i></span></span>=<b name="data/averaging.md_working_5.datt1">t1</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which to store data for averaging<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with whihc to clear the data that is being averaged<i></i></span></span>=0
</span></span><span id="data/averaging.md_working_5.data1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/averaging.md_working_5.data1")'># a1: AVERAGE ARG=t1 STRIDE=1</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/averaging.md_working_5.data1_weight" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1_weight","data/averaging.md_working_5.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_5.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/ONES" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=1
<b name="data/averaging.md_working_5.data1_denom" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1_denom","data/averaging.md_working_5.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_5.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_5.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_5.data1_sin" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1_sin","data/averaging.md_working_5.data1_sin","black")'>a1_sin</b><span style="display:none;" id="data/averaging.md_working_5.data1_sin">The CUSTOM action with label <b>a1_sin</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_sin</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_5.datt1">t1</b>,<b name="data/averaging.md_working_5.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=y*sin((x--pi)/((pi--pi)/(pi+pi))) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/averaging.md_working_5.data1_cos" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1_cos","data/averaging.md_working_5.data1_cos","black")'>a1_cos</b><span style="display:none;" id="data/averaging.md_working_5.data1_cos">The CUSTOM action with label <b>a1_cos</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_cos</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_5.datt1">t1</b>,<b name="data/averaging.md_working_5.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=y*cos((x--pi)/((pi--pi)/(pi+pi))) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/averaging.md_working_5.data1_sinsum" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1_sinsum","data/averaging.md_working_5.data1_sinsum","black")'>a1_sinsum</b><span style="display:none;" id="data/averaging.md_working_5.data1_sinsum">The ACCUMULATE action with label <b>a1_sinsum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_sinsum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_5.data1_sin">a1_sin</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_5.data1_cossum" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1_cossum","data/averaging.md_working_5.data1_cossum","black")'>a1_cossum</b><span style="display:none;" id="data/averaging.md_working_5.data1_cossum">The ACCUMULATE action with label <b>a1_cossum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_cossum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_5.data1_cos">a1_cos</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
<b name="data/averaging.md_working_5.data1" onclick='showPath("data/averaging.md_working_5.dat","data/averaging.md_working_5.data1","data/averaging.md_working_5.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_5.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_5.data1_sinsum">a1_sinsum</b>,<b name="data/averaging.md_working_5.data1_cossum">a1_cossum</b>,<b name="data/averaging.md_working_5.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=-pi+((pi--pi)/(pi+pi))*atan2(x/z,y/z) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=-pi,pi
<span style="color:blue"># --- End of included input --- </span></span><span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_5.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

When this is expanded you have the following:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_6.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_6.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_6.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_6.datt1" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.datt1","data/averaging.md_working_6.datt1","black")'>t1</b><span style="display:none;" id="data/averaging.md_working_6.datt1">The TORSION action with label <b>t1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1</td><td width="5%"><font color="black">scalar</font></td><td>the TORSION involving these atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">TORSION<span class="right">Calculate one or multiple torsional angles. <a href="https://www.plumed.org/doc-master/user-doc/html/TORSION" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the four atoms involved in the torsional angle<i></i></span></span>=1,2,3,4
<span id="data/averaging.md_working_6.datdefa1_weight_short"><b name="data/averaging.md_working_6.data1_weight" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1_weight","data/averaging.md_working_6.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_6.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1
</span><span id="data/averaging.md_working_6.datdefa1_weight_long" style="display:none;"><b name="data/averaging.md_working_6.data1_weight" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1_weight","data/averaging.md_working_6.data1_weight","black")'>a1_weight</b>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=1  <span class="plumedtooltip">NROWS<span class="right"> the number of rows in your input matrix<i></i></span></span>=0 <span class="plumedtooltip">NCOLS<span class="right"> the number of columns in your matrix<i></i></span></span>=0
</span><span id="data/averaging.md_working_6.datdefa1_denom_short"><b name="data/averaging.md_working_6.data1_denom" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1_denom","data/averaging.md_working_6.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_6.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdefa1_denom");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_6.data1_weight">a1_weight</b> 
</span><span id="data/averaging.md_working_6.datdefa1_denom_long" style="display:none;"><b name="data/averaging.md_working_6.data1_denom" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1_denom","data/averaging.md_working_6.data1_denom","black")'>a1_denom</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdefa1_denom");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_6.data1_weight">a1_weight</b>  <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1 <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><b name="data/averaging.md_working_6.data1_sin" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1_sin","data/averaging.md_working_6.data1_sin","black")'>a1_sin</b><span style="display:none;" id="data/averaging.md_working_6.data1_sin">The CUSTOM action with label <b>a1_sin</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_sin</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_6.datt1">t1</b>,<b name="data/averaging.md_working_6.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=y*sin((x+pi)/1) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<b name="data/averaging.md_working_6.data1_cos" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1_cos","data/averaging.md_working_6.data1_cos","black")'>a1_cos</b><span style="display:none;" id="data/averaging.md_working_6.data1_cos">The CUSTOM action with label <b>a1_cos</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_cos</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_6.datt1">t1</b>,<b name="data/averaging.md_working_6.data1_weight">a1_weight</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=y*cos((x+pi)/1) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span id="data/averaging.md_working_6.datdeft1_sinsum_short"><b name="data/averaging.md_working_6.datt1_sinsum" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.datt1_sinsum","data/averaging.md_working_6.datt1_sinsum","black")'>t1_sinsum</b><span style="display:none;" id="data/averaging.md_working_6.datt1_sinsum">The ACCUMULATE action with label <b>t1_sinsum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1_sinsum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdeft1_sinsum");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_6.data1_sin">a1_sin</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_6.datdeft1_sinsum_long" style="display:none;"><b name="data/averaging.md_working_6.datt1_sinsum" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.datt1_sinsum","data/averaging.md_working_6.datt1_sinsum","black")'>t1_sinsum</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdeft1_sinsum");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_6.data1_sin">a1_sin</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><span id="data/averaging.md_working_6.datdeft1_cossum_short"><b name="data/averaging.md_working_6.datt1_cossum" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.datt1_cossum","data/averaging.md_working_6.datt1_cossum","black")'>t1_cossum</b><span style="display:none;" id="data/averaging.md_working_6.datt1_cossum">The ACCUMULATE action with label <b>t1_cossum</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">t1_cossum</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdeft1_cossum");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_6.data1_cos">a1_cos</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_6.datdeft1_cossum_long" style="display:none;"><b name="data/averaging.md_working_6.datt1_cossum" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.datt1_cossum","data/averaging.md_working_6.datt1_cossum","black")'>t1_cossum</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_6.datdeft1_cossum");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_6.data1_cos">a1_cos</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><b name="data/averaging.md_working_6.data1" onclick='showPath("data/averaging.md_working_6.dat","data/averaging.md_working_6.data1","data/averaging.md_working_6.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_6.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_6.datt1_sinsum">t1_sinsum</b>,<b name="data/averaging.md_working_6.datt1_cossum">t1_cossum</b>,<b name="data/averaging.md_working_6.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=-pi+1*atan2(x/z,y/z) <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=-pi,pi
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_6.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

Readers of the manual can thus see how the average is calculated in a way that takes the periodicity of the variable into account without having to look inside the PLUMED source code.

## Spatial averages

Suppose that you have an input file that calculates the coordination numbers of 100 atoms like the one shown below:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_7.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_7.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_7.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment"># c1: COORDINATIONNUMBER SPECIES=1-100 SWITCH={RATIONAL R_0=1}</span>
<span style="color:blue" class="comment"># a1: ACCUMULATE ARG=c1 STRIDE=1</span>
</pre>
 {% endraw %} 

Should `a1`, the value that is output by the ACCUMULATE action here be a scalar or a vector?  In other words, should PLUMED assume that the user wants to add all 100 numbers calculated by the 
COORDINATIONNUMBER command all together when ACCUMULATE is called or should it instead assume that the user wants to accumulate individual averages for each of the 100 coordination numbers?

To me the answer to this question is obvious.  The ACCUMULATE action should output a vector.  In other words, the first element of the vector `a1` should be the sum of all the values the coordination
number of atom 1 took, the second element should be the sum of the vlaues the coordination number of atom 2 took and so on.  If the user had wanted us to convert the vector computed by the 
COORINDATIONNUMBER action to a scalar they would have told us they were doing this by using an input like this:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_8.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_8.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_8.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span id="data/averaging.md_working_8.datc1_short"><b name="data/averaging.md_working_8.datc1" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.datc1","data/averaging.md_working_8.datc1_shortcut","blue")'>c1</b><span style="display:none;" id="data/averaging.md_working_8.datc1_shortcut">The COORDINATIONNUMBER action with label <b>c1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1</td><td width="5%"><font color="blue">vector</font></td><td>the coordination numbers of the specified atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">COORDINATIONNUMBER<span class="right">Calculate the coordination numbers of atoms so that you can then calculate functions of the distribution of This action is <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_8.datc1");'>a shortcut</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/COORDINATIONNUMBER">More details</a><i></i></span></span> <span class="plumedtooltip">SPECIES<span class="right">the list of atoms for which the symmetry function is being calculated and the atoms that can be in the environments<i></i></span></span>=1-100 <span class="plumedtooltip">SWITCH<span class="right">the switching function that it used in the construction of the contact matrix. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={RATIONAL R_0=1}
</span><span id="data/averaging.md_working_8.datc1_long" style="display:none;"><span style="color:blue" class="comment"># PLUMED interprets the command:
</span><span class="toggler" style="color:red" onclick='toggleDisplay("data/averaging.md_working_8.datc1")'># c1: COORDINATIONNUMBER SPECIES=1-100 SWITCH={RATIONAL R_0=1}</span>
<span style="color:blue" class="comment"># as follows (Click the red comment above to revert to the short version of the input):</span>
<b name="data/averaging.md_working_8.datc1_grp" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.datc1_grp","data/averaging.md_working_8.datc1_grp","violet")'>c1_grp</b><span style="display:none;" id="data/averaging.md_working_8.datc1_grp">The GROUP action with label <b>c1_grp</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_grp</td><td width="5%"><font color="violet">atoms</font></td><td>indices of atoms specified in GROUP</td></tr></table></span>: <span class="plumedtooltip" style="color:green">GROUP<span class="right">Define a group of atoms so that a particular list of atoms can be referenced with a single label in definitions of CVs or virtual atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/GROUP" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the numerical indexes for the set of atoms in the group<i></i></span></span>=1-100
<b name="data/averaging.md_working_8.datc1_mat" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.datc1_mat","data/averaging.md_working_8.datc1_mat","red")'>c1_mat</b><span style="display:none;" id="data/averaging.md_working_8.datc1_mat">The CONTACT_MATRIX action with label <b>c1_mat</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_mat</td><td width="5%"><font color="red">matrix</font></td><td>a matrix containing the weights for the bonds between each pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONTACT_MATRIX<span class="right">Adjacency matrix in which two atoms are adjacent if they are within a certain cutoff. <a href="https://www.plumed.org/doc-master/user-doc/html/CONTACT_MATRIX" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">GROUP<span class="right">specifies the list of atoms that should be assumed indistinguishable<i></i></span></span>=1-100 <span class="plumedtooltip">SWITCH<span class="right">the input for the switching function that acts upon the distance between each pair of atoms. Options for this keyword are explained in the documentation for <a href="https://www.plumed.org/doc-master/user-doc/html/LESS_THAN">LESS_THAN</a>.<i></i></span></span>={RATIONAL R_0=1}
<b name="data/averaging.md_working_8.datc1_ones" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.datc1_ones","data/averaging.md_working_8.datc1_ones","blue")'>c1_ones</b><span style="display:none;" id="data/averaging.md_working_8.datc1_ones">The CONSTANT action with label <b>c1_ones</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_ones</td><td width="5%"><font color="blue">vector</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ONES<span class="right">Create a constant vector with all elements equal to one <a href="https://www.plumed.org/doc-master/user-doc/html/ONES" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">SIZE<span class="right">the number of ones that you would like to create<i></i></span></span>=100
<b name="data/averaging.md_working_8.datc1" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.datc1","data/averaging.md_working_8.datc1","blue")'>c1</b><span style="display:none;" id="data/averaging.md_working_8.datc1">The MATRIX_VECTOR_PRODUCT action with label <b>c1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1</td><td width="5%"><font color="blue">vector</font></td><td>the vector that is obtained by taking the product between the matrix and the vector that were input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MATRIX_VECTOR_PRODUCT<span class="right">Calculate the product of the matrix and the vector <a href="https://www.plumed.org/doc-master/user-doc/html/MATRIX_VECTOR_PRODUCT" style="color:green">More details</a><i></i></span></span>  <span class="plumedtooltip">ARG<span class="right">the label for the matrix and the vector/scalar that are being multiplied<i></i></span></span>=<b name="data/averaging.md_working_8.datc1_mat">c1_mat</b>,<b name="data/averaging.md_working_8.datc1_ones">c1_ones</b>
<span style="color:blue"># --- End of included input --- </span></span><b name="data/averaging.md_working_8.datc1_mean" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.datc1_mean","data/averaging.md_working_8.datc1_mean","black")'>c1_mean</b><span style="display:none;" id="data/averaging.md_working_8.datc1_mean">The MEAN action with label <b>c1_mean</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">c1_mean</td><td width="5%"><font color="black">scalar</font></td><td>the MEAN of the elements in the input value</td></tr></table></span>: <span class="plumedtooltip" style="color:green">MEAN<span class="right">Calculate the arithmetic mean of the elements in a vector <a href="https://www.plumed.org/doc-master/user-doc/html/MEAN" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the vector/matrix/grid whose elements shuld be added together<i></i></span></span>=<b name="data/averaging.md_working_8.datc1">c1</b> <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span id="data/averaging.md_working_8.datdefa1_short"><b name="data/averaging.md_working_8.data1" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.data1","data/averaging.md_working_8.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_8.data1">The ACCUMULATE action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_8.datdefa1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_8.datc1_mean">c1_mean</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_8.datdefa1_long" style="display:none;"><b name="data/averaging.md_working_8.data1" onclick='showPath("data/averaging.md_working_8.dat","data/averaging.md_working_8.data1","data/averaging.md_working_8.data1","black")'>a1</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_8.datdefa1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_8.datc1_mean">c1_mean</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span></pre>
 {% endraw %} 

I think this keeps things transparent for users. I wouldn't even add shortcuts around for this sort of functionality. I think that the flexibility provided here for folks doing a mixture of time and spatial 
averaging makes things pretty straightforward and transparent.

## Averages over replicas

The example input file below shows how you can gather all the data from all replicas in one place using the GATHER_REPLICAS command:

{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_9.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_9.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_9.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<span style="color:blue" class="comment">#SETTINGS NREPLICAS=2</span>
<b name="data/averaging.md_working_9.datd1" onclick='showPath("data/averaging.md_working_9.dat","data/averaging.md_working_9.datd1","data/averaging.md_working_9.datd1","black")'>d1</b><span style="display:none;" id="data/averaging.md_working_9.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2
<span id="data/averaging.md_working_9.datdefr1_short"><b name="data/averaging.md_working_9.datr1" onclick='showPath("data/averaging.md_working_9.dat","data/averaging.md_working_9.datr1","data/averaging.md_working_9.datr1","black")'>r1</b><span style="display:none;" id="data/averaging.md_working_9.datr1">The RESTRAINT action with label <b>r1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">r1.bias</td><td width="5%"><font color="black">scalar</font></td><td>the instantaneous value of the bias potential</td></tr><tr><td width="5%">r1.force2</td><td width="5%"><font color="black">scalar</font></td><td>the instantaneous value of the squared force due to this bias potential</td></tr></table></span>: <span class="plumedtooltip" style="color:green">RESTRAINT<span class="right">Adds harmonic and/or linear restraints on one or more variables. This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_9.datdefr1");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/RESTRAINT">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values the harmonic restraint acts upon<i></i></span></span>=<b name="data/averaging.md_working_9.datd1">d1</b> <span class="plumedtooltip">AT<span class="right">the position of the restraint<i></i></span></span>=<span class="plumedtooltip">@replicas:<span class="right">This keyword specifies that different replicas have different values for this quantity.  See <a href="https://www.plumed.org/doc-master/user-doc/html/parsing.html">here for more details.</a><i></i></span></span>1.0,1.2 <span class="plumedtooltip">KAPPA<span class="right"> specifies that the restraint is harmonic and what the values of the force constants on each of the variables are<i></i></span></span>=10
</span><span id="data/averaging.md_working_9.datdefr1_long" style="display:none;"><b name="data/averaging.md_working_9.datr1" onclick='showPath("data/averaging.md_working_9.dat","data/averaging.md_working_9.datr1","data/averaging.md_working_9.datr1","black")'>r1</b>: <span class="plumedtooltip" style="color:green">RESTRAINT<span class="right">Adds harmonic and/or linear restraints on one or more variables. This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_9.datdefr1");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/RESTRAINT">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values the harmonic restraint acts upon<i></i></span></span>=<b name="data/averaging.md_working_9.datd1">d1</b> <span class="plumedtooltip">AT<span class="right">the position of the restraint<i></i></span></span>=<span class="plumedtooltip">@replicas:<span class="right">This keyword specifies that different replicas have different values for this quantity.  See <a href="https://www.plumed.org/doc-master/user-doc/html/parsing.html">here for more details.</a><i></i></span></span>1.0,1.2 <span class="plumedtooltip">KAPPA<span class="right"> specifies that the restraint is harmonic and what the values of the force constants on each of the variables are<i></i></span></span>=10  <span class="plumedtooltip">SLOPE<span class="right"> specifies that the restraint is linear and what the values of the force constants on each of the variables are<i></i></span></span>=0.0
</span><b name="data/averaging.md_working_9.datr1g" onclick='showPath("data/averaging.md_working_9.dat","data/averaging.md_working_9.datr1g","data/averaging.md_working_9.datr1g","black")'>r1g</b><span style="display:none;" id="data/averaging.md_working_9.datr1g">The GATHER_REPLICAS action with label <b>r1g</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">r1g.rep-1</td><td width="5%"><font color="black">scalar</font></td><td>the input arguments for each of the replicas  This is the 1th of these quantities</td></tr><tr><td width="5%">r1g.rep-2</td><td width="5%"><font color="black">scalar</font></td><td>the input arguments for each of the replicas  This is the 2th of these quantities</td></tr></table></span>: <span class="plumedtooltip" style="color:green">GATHER_REPLICAS<span class="right">Create a vector that contains the copies of the input quantities from all replicas <a href="https://www.plumed.org/doc-master/user-doc/html/GATHER_REPLICAS" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the argument from the various replicas that you would like to gather<i></i></span></span>=<b name="data/averaging.md_working_9.datr1">r1.bias</b>
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_9.datr1g">r1g.rep-1</b>,<b name="data/averaging.md_working_9.datr1g">r1g.rep-2</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=colvar
</pre>
 {% endraw %} 

The GATHER_REPLICAS command creates one PLUMED value object for each replica. The $N$ values output by GATHER_REPLICA contain the values of the quantities on each of the $N$ replicas.  By using GATHER_REPLICAS you 
can meke the values that you have on other replicas accessible on all replicas.  Consequently, if you can run a four replica simulation to compute the average distance between atom 1 and atom 2 you can get the average by doing:


{% raw %}
<div class="plumedpreheader">
<div class="headerInfo" id="value_details_data/averaging.md_working_10.dat"> Click on the labels of the actions for more information on what each action computes </div>
<div class="containerBadge">
<div class="headerBadge"><a href="averaging.md_working_10.dat.plumed.stderr"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested onv2.9" /></a></div>
<div class="headerBadge"><a href="averaging.md_working_10.dat.plumed_master.stderr"><img src="https://img.shields.io/badge/master-passing-green.svg" alt="tested onmaster" /></a></div>
</div>
</div>
<pre class="plumedlisting">
<b name="data/averaging.md_working_10.datd1" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.datd1","data/averaging.md_working_10.datd1","black")'>d1</b><span style="display:none;" id="data/averaging.md_working_10.datd1">The DISTANCE action with label <b>d1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1</td><td width="5%"><font color="black">scalar</font></td><td>the DISTANCE between this pair of atoms</td></tr></table></span>: <span class="plumedtooltip" style="color:green">DISTANCE<span class="right">Calculate the distance/s between pairs of atoms. <a href="https://www.plumed.org/doc-master/user-doc/html/DISTANCE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ATOMS<span class="right">the pair of atom that we are calculating the distance between<i></i></span></span>=1,2
<b name="data/averaging.md_working_10.datd1g" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.datd1g","data/averaging.md_working_10.datd1g","black")'>d1g</b><span style="display:none;" id="data/averaging.md_working_10.datd1g">The GATHER_REPLICAS action with label <b>d1g</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1g.rep-1</td><td width="5%"><font color="black">scalar</font></td><td>the input arguments for each of the replicas  This is the 1th of these quantities</td></tr></table></span>: <span class="plumedtooltip" style="color:green">GATHER_REPLICAS<span class="right">Create a vector that contains the copies of the input quantities from all replicas <a href="https://www.plumed.org/doc-master/user-doc/html/GATHER_REPLICAS" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the argument from the various replicas that you would like to gather<i></i></span></span>=<b name="data/averaging.md_working_10.datd1">d1</b>
<b name="data/averaging.md_working_10.datd1s" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.datd1s","data/averaging.md_working_10.datd1s","black")'>d1s</b><span style="display:none;" id="data/averaging.md_working_10.datd1s">The COMBINE action with label <b>d1s</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">d1s</td><td width="5%"><font color="black">scalar</font></td><td>a linear compbination</td></tr></table></span>: <span class="plumedtooltip" style="color:green">COMBINE<span class="right">Calculate a polynomial combination of a set of other variables. <a href="https://www.plumed.org/doc-master/user-doc/html/COMBINE" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_10.datd1">d1.*</b> <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span id="data/averaging.md_working_10.datdefa1_weight_short"><b name="data/averaging.md_working_10.data1_weight" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1_weight","data/averaging.md_working_10.data1_weight","black")'>a1_weight</b><span style="display:none;" id="data/averaging.md_working_10.data1_weight">The CONSTANT action with label <b>a1_weight</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_weight</td><td width="5%"><font color="black">scalar</font></td><td>the constant value that was read from the plumed input</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_10.datdefa1_weight");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=4
</span><span id="data/averaging.md_working_10.datdefa1_weight_long" style="display:none;"><b name="data/averaging.md_working_10.data1_weight" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1_weight","data/averaging.md_working_10.data1_weight","black")'>a1_weight</b>: <span class="plumedtooltip" style="color:green">CONSTANT<span class="right">Create a constant value that can be passed to actions This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_10.datdefa1_weight");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/CONSTANT">More details</a><i></i></span></span> <span class="plumedtooltip">VALUES<span class="right">the numbers that are in your constant value<i></i></span></span>=4  <span class="plumedtooltip">NROWS<span class="right"> the number of rows in your input matrix<i></i></span></span>=0 <span class="plumedtooltip">NCOLS<span class="right"> the number of columns in your matrix<i></i></span></span>=0
</span><span id="data/averaging.md_working_10.datdefa1_denom_short"><b name="data/averaging.md_working_10.data1_denom" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1_denom","data/averaging.md_working_10.data1_denom","black")'>a1_denom</b><span style="display:none;" id="data/averaging.md_working_10.data1_denom">The ACCUMULATE action with label <b>a1_denom</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_denom</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_10.datdefa1_denom");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_10.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_10.datdefa1_denom_long" style="display:none;"><b name="data/averaging.md_working_10.data1_denom" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1_denom","data/averaging.md_working_10.data1_denom","black")'>a1_denom</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_10.datdefa1_denom");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_10.data1_weight">a1_weight</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><span id="data/averaging.md_working_10.datdefa1_numer_short"><b name="data/averaging.md_working_10.data1_numer" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1_numer","data/averaging.md_working_10.data1_numer","black")'>a1_numer</b><span style="display:none;" id="data/averaging.md_working_10.data1_numer">The ACCUMULATE action with label <b>a1_numer</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1_numer</td><td width="5%"><font color="black">scalar</font></td><td>a sum calculated from the time series of the input quantity</td></tr></table></span>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action has <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_10.datdefa1_numer");'>hidden defaults</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_10.datd1s">d1s</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1
</span><span id="data/averaging.md_working_10.datdefa1_numer_long" style="display:none;"><b name="data/averaging.md_working_10.data1_numer" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1_numer","data/averaging.md_working_10.data1_numer","black")'>a1_numer</b>: <span class="plumedtooltip" style="color:green">ACCUMULATE<span class="right">Sum the elements of this value over the course of the trajectory This action uses the <a class="toggler" href='javascript:;' onclick='toggleDisplay("data/averaging.md_working_10.datdefa1_numer");'>defaults shown here</a>. <a href="https://www.plumed.org/doc-master/user-doc/html/ACCUMULATE">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the label of the argument that is being added to on each timestep<i></i></span></span>=<b name="data/averaging.md_working_10.datd1s">d1s</b> <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the data should be collected and added to the quantity being averaged<i></i></span></span>=1  <span class="plumedtooltip">CLEAR<span class="right"> the frequency with which to clear all the accumulated data<i></i></span></span>=0
</span><b name="data/averaging.md_working_10.data1" onclick='showPath("data/averaging.md_working_10.dat","data/averaging.md_working_10.data1","data/averaging.md_working_10.data1","black")'>a1</b><span style="display:none;" id="data/averaging.md_working_10.data1">The CUSTOM action with label <b>a1</b> calculates the following quantities:<table  align="center" frame="void" width="95%" cellpadding="5%"><tr><td width="5%"><b> Quantity </b>  </td><td width="5%"><b> Type </b>  </td><td><b> Description </b> </td></tr><tr><td width="5%">a1</td><td width="5%"><font color="black">scalar</font></td><td>an arbitrary function</td></tr></table></span>: <span class="plumedtooltip" style="color:green">CUSTOM<span class="right">Calculate a combination of variables using a custom expression. <a href="https://www.plumed.org/doc-master/user-doc/html/CUSTOM" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the values input to this function<i></i></span></span>=<b name="data/averaging.md_working_10.data1_numer">a1_numer</b>,<b name="data/averaging.md_working_10.data1_denom">a1_denom</b> <span class="plumedtooltip">FUNC<span class="right">the function you wish to evaluate<i></i></span></span>=x/y <span class="plumedtooltip">PERIODIC<span class="right">if the output of your function is periodic then you should specify the periodicity of the function<i></i></span></span>=NO
<span class="plumedtooltip" style="color:green">PRINT<span class="right">Print quantities to a file. <a href="https://www.plumed.org/doc-master/user-doc/html/PRINT" style="color:green">More details</a><i></i></span></span> <span class="plumedtooltip">ARG<span class="right">the labels of the values that you would like to print to the file<i></i></span></span>=<b name="data/averaging.md_working_10.data1">a1</b> <span class="plumedtooltip">FILE<span class="right">the name of the file on which to output these quantities<i></i></span></span>=average <span class="plumedtooltip">STRIDE<span class="right"> the frequency with which the quantities of interest should be output<i></i></span></span>=1
</pre>
 {% endraw %} 

Flexibility is again offered to users here by separating the act of gathering data from replicas and adding it all together in the input file.  Also notice that if the quantity input to GATHER_REPLICAS is a vector/matrix or grid
then the output actions will be vectors matrices or grids.  In short, the syntax here agsin offers users a great deal of flexibility by separating out these three ways of collecting samples for averaging.  This flexibility hopefully also
helps users to understand how the averages that they are computing are being constructed.
